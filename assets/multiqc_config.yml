report_comment: >
  This report has been generated by the <a href="https://github.com/nf-core/stableexpression/tree/dev" target="_blank">nf-core/stableexpression</a>
  analysis pipeline. For information about how to interpret these results, please see the
  <a href="https://nf-co.re/stableexpression/dev/docs/output" target="_blank">documentation</a>.

report_section_order:
  "nf-core-stableexpression-methods-description":
    order: -1000
  software_versions:
    order: -1001
  "nf-core-stableexpression-summary":
    order: -1002

export_plots: true

run_modules:
  - custom_content

disable_version_detection: true

max_table_rows: 5000

table_cond_formatting_colours:
  - very_low: "#337ab7"
  - low: "#5bc0de"
  - medium: "#5cb85c"
  - high: "#f0ad4e"
  - very_high: "#d9534f"

custom_data:
  ranked_top_stable_genes_summary:
    section_name: "Top stable genes - ranked by stability"
    file_format: "csv"
    no_violin: true
    sort_rows: false
    description: |
      Expression descriptive statistics of all genes, ranked by stability.
      Expression were normalised and cpm (counts per million) were used for all calculations.
      Genes are sorted by M-measure - from the most stable to the least stable.
    plot_type: "table"
    pconfig:
      col1_header: "Rank"
    headers:
      rank:
        rid: "Rank"
        hidden: true
      ensembl_gene_id:
        title: "Ensembl Gene ID"
        description: |
          Gene IDs as shown in Ensembl
      m_measure:
        title: "Stability"
        description: |
          Gene stability measure M as defined in Vandesompele et al., Genome Biology (2002).
          Lower values indicate higher stability.
          M-measures were calculated directly from cpm (normalised count per million).
        format: "{:,.4f}"
        #minrange: 0
      standard_deviation:
        title: "Std"
        description: |
          Standard deviation of the expression across samples.
          For each sample, expression was first computed as log2(cpm + 1), then fitted to [0, 1] using scikit-learn's QuantileTransformer.
        format: "{:,.4f}"
      variation_coefficient:
        title: "Var coeff"
        description: |
          Variation coefficient: std(expression) / mean(expression).
          For each sample, expression was first computed as log2(cpm + 1), then fitted to [0, 1] using scikit-learn's QuantileTransformer.
        format: "{:,.4f}"
      mean:
        title: "Average"
        description: |
          Average expression across samples.
          For each sample, expression was first computed as log2(cpm + 1), then fitted to [0, 1] using scikit-learn's QuantileTransformer.
        format: "{:,.4f}"
      expression_level_status:
        title: "Expression level"
        description: |
          Indication about the average gene expression level compared to the whole pool of genes.
          Expression in [0, 0.05]: Very low expression.
          Expression in [0.05, 0.1]: Low expression.
          Expression in [0.1, 0.9]: Medium range.
          Expression in [0.9, 0.95]: High expression.
          Expression in [0.95, 1]: Very high expression.
        cond_formatting_rules:
          very_high:
            - s_eq: "Very high expression"
          high:
            - s_eq: "High expression"
          medium:
            - s_eq: "Medium range"
          low:
            - s_eq: "Low expression"
          very_low:
            - s_eq: "Very low expression"
      name:
        title: "Ensembl name"
        description: |
          Gene name as shown in Ensembl (g:Profiler)
      description:
        title: "Ensembl description"
        description: |
          Gene description as shown in Ensembl (g:Profiler)
      original_gene_ids:
        title: "Original gene IDs"
        description: |
          Original gene IDs as stated in the input (provided or downloaded) datasets
      total_nb_nulls:
        title: "Nb nulls"
        description: |
          Number of samples in which the gene is not represented.
      nb_nulls_valid_samples:
        title: "Nb nulls (valid samples)"
        description: |
          Number of samples in which the gene is not represented, excluding samples with particularly low overall gene count.

  expression_distributions_top_stable_genes:
    section_name: "Expression distribution of the top stable genes (ranked by stability)"
    file_format: "csv"
    pconfig:
      sort_samples: false
    description: |
      Distribution of gene expression across samples for the most stable genes.
      For each sample, expression was first computed as log2(cpm + 1), then fitted to [0, 1] using scikit-learn's QuantileTransformer.
      Genes are ranked from the most stable to the least stable.
    plot_type: "boxplot"
    #xlab: Expression
    #ylab: Gene

  gene_statistics:
    section_name: "Descriptive statistics - All genes"
    file_format: "csv"
    description: |
      Distribution of descriptive statistics for all genes.
      Expression was first computed as log2(cpm + 1), then fitted to [0, 1] using scikit-learn's QuantileTransformer.
    plot_type: "violin"
    pconfig:
      col1_header: "Ensembl Gene ID"
    headers:
      # colors from https://colorbrewer2.org/#type=diverging&scheme=BrBG&n=8
      m_measure:
        title: "Gene stability M-measure"
        description: |
          Gene stability measure M as defined in Vandesompele et al., Genome Biology (2002)
        color: "#bf812d"
      standard_deviation:
        title: "Standard deviation"
        description: |
          Standard deviation of the expression across samples
        color: "#bf812d"
      variation_coefficient:
        title: "Variation coefficient"
        description: |
          Ratio of standard deviation to mean
        color: "#f6e8c3"
      mean:
        title: "Average"
        description: |
          Average expression across samples.
          Expression was first computed as log2(cpm + 1), then fitted to [0, 1] using scikit-learn's QuantileTransformer.
        color: "#01665e"

  gene_counts:
    section_name: "Gene counts"
    file_format: "csv"
    description: |
      Distribution of gene counts across samples.
    plot_type: "linegraph"
    pconfig:
      categories: true
    headers:
      count:
        title: "Gene count"
        description: |
          Number of genes included in the dataset after normalisation
        color: "#bf812d"

  skewness:
    section_name: "Skewness"
    file_format: "csv"
    description: |
      Distribution of expression skewness across samples.
    plot_type: "linegraph"
    pconfig:
      categories: true
    headers:
      skewness:
        title: "Skewness"
        description: |
          Skewness of the distribution of the normalised expression
        color: "#bf812d"

  uniform_distribution_probabilities:
    section_name: "Probabilities of uniform count distribution"
    file_format: "csv"
    description: |
      Pvalue of Kolmogorov-Smirnov test to uniform distribution.
      The higher the pvalue, the more likely the distribution is uniform.
      If the pvalue < 0.05, the null hypothesis is rejected and the distribution is not uniform.
      Samples showing a pvalue lower than the threshold (set in parameters) when not considered for stability scoring.
    plot_type: "linegraph"
    pconfig:
      categories: true
      logswitch: true
      logswitch_active: true
      logswitch_label: "Log10"
    headers:
      kolmogorov_smirnov_to_uniform_dist_pvalue:
        title: "KS test to uniform distribution - pvalue"
        description: |
          Pvalue of Kolmogorov-Smirnov test to uniform distribution.
        color: "#bf812d"

  distribution_correlations:
    section_name: "Correlation to mean count distribution"
    file_format: "csv"
    description: |
      For each sample, the correlation between the count distribution and the overall mean count distribution (including all samples) was computed.
      This graph can help identify samples that are deviating from the mean count distribution.
    plot_type: "linegraph"
    pconfig:
      categories: true
    headers:
      correlation:
        title: "Pearson correlation"
        description: |
          Pearson correlation
        color: "#bf812d"

#violin_downsample_after: 10000

log_filesize_limit: 10000000000 # 10GB

sp:
  ranked_top_stable_genes_summary:
    fn: "*top_stable_genes_summary.csv"
    max_filesize: 5000000 # 5MB
  expression_distributions_top_stable_genes:
    fn: "*top_stable_genes_transposed_log_counts.csv"
    max_filesize: 50000000 # 50MB
  gene_statistics:
    fn: "*stats_all_genes.csv"
    max_filesize: 50000000 # 50MB
  gene_counts:
    fn: "*gene_count_statistics.csv"
  skewness:
    fn: "*skewness_statistics.csv"
  uniform_distribution_probabilities:
    fn: "*ks_test_statistics.csv"
  distribution_correlations:
    fn: "*distribution_correlations.csv"
